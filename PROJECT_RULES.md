# Dead Frontier 自動交易系統 - 項目開發規則

## 🎯 Playwright MCP 使用規則

### 何時使用 Playwright MCP

#### ✅ **必須使用場景**

1. **頁面結構分析階段**
   ```
   觸發條件：需要了解新頁面或頁面結構變化時
   使用工具：mcp_playwright_browser_navigate + mcp_playwright_browser_snapshot
   目的：獲取完整的 DOM 結構和可交互元素
   ```

2. **元素定位器開發**
   ```
   觸發條件：編寫新的元素選擇器或現有選擇器失效時
   使用工具：mcp_playwright_browser_snapshot + element 分析
   目的：找到最穩定和可靠的元素定位方法
   ```

3. **交互流程驗證**
   ```
   觸發條件：實現新的交互邏輯前
   使用工具：完整的 MCP 工具鏈
   目的：驗證交互步驟的可行性和穩定性
   ```

4. **錯誤場景調試**
   ```
   觸發條件：Python 代碼出現交互問題時
   使用工具：mcp_playwright_browser_snapshot + 特定操作測試
   目的：理解錯誤原因並找到解決方案
   ```

#### 🔄 **建議使用場景**

5. **反檢測策略測試**
   ```
   觸發條件：開發或優化反檢測機制時
   使用工具：mcp_playwright_browser_* 系列工具
   目的：快速測試不同策略的效果
   ```

6. **新功能原型開發**
   ```
   觸發條件：實現新功能前的可行性驗證
   使用工具：根據具體需求選擇相應工具
   目的：快速驗證想法並獲得反饋
   ```

#### ❌ **不使用場景**

7. **生產環境運行**
   ```
   原因：MCP 主要用於開發和測試，不適合生產環境
   替代：使用最終的 Python + Playwright 代碼
   ```

8. **高頻重複操作**
   ```
   原因：MCP 調用有延遲，不適合需要高效率的批量操作
   替代：編寫專門的 Python 腳本
   ```

---

## 🔧 開發工作流程

### 階段 1：頁面分析
```
1. 使用 MCP 導航到目標頁面
2. 獲取頁面快照和結構
3. 分析關鍵元素和交互點
4. 記錄選擇器和交互模式
```

### 階段 2：原型開發
```
1. 使用 MCP 測試基本交互
2. 驗證購買/銷售流程
3. 測試錯誤處理
4. 優化元素定位策略
```

### 階段 3：Python 實現
```
1. 基於 MCP 測試結果編寫 Python 代碼
2. 實現 BrowserManager 和相關模組
3. 集成反檢測和人類行為模擬
4. 進行集成測試
```

### 階段 4：驗證優化
```
1. 使用 MCP 驗證 Python 實現的正確性
2. 對比 MCP 測試結果和 Python 執行結果
3. 優化性能和穩定性
4. 最終驗證
```

---

## 📝 使用最佳實踐

### 1. **頁面分析最佳實踐**
- 總是先獲取頁面快照再進行操作
- 記錄重要元素的多種選擇器選項
- 注意頁面加載狀態和動態內容

### 2. **元素交互最佳實踐**
- 驗證元素存在後再進行交互
- 測試不同的點擊和輸入方式
- 考慮元素可能的狀態變化

### 3. **錯誤處理最佳實踐**
- 測試各種錯誤場景
- 記錄錯誤響應和恢復策略
- 驗證超時和重試機制

### 4. **性能考慮**
- MCP 調用有延遲，不要過度使用
- 批量分析時合理安排調用順序
- 保存重要的分析結果避免重複調用

---

## 🎯 具體應用示例

### 示例 1：分析市場頁面結構
```markdown
目標：了解 marketplace 頁面的商品列表結構

步驟：
1. mcp_playwright_browser_navigate -> marketplace URL
2. mcp_playwright_browser_snapshot -> 獲取完整頁面結構
3. 分析 .fakeItem 元素及其屬性
4. 記錄價格、數量、賣家等信息的選擇器
5. 測試搜索功能的交互方式
```

### 示例 2：驗證購買流程
```markdown
目標：測試完整的商品購買流程

步驟：
1. 導航到 marketplace 並獲取快照
2. mcp_playwright_browser_click -> 點擊目標商品
3. mcp_playwright_browser_snapshot -> 檢查商品詳情頁
4. mcp_playwright_browser_click -> 點擊購買按鈕
5. mcp_playwright_browser_snapshot -> 檢查確認對話框
6. 測試確認和取消操作
```

### 示例 3：庫存管理分析
```markdown
目標：分析庫存頁面的商品管理功能

步驟：
1. 切換到銷售標籤頁
2. 獲取庫存區域的快照
3. 分析庫存商品的元素結構
4. 測試右鍵菜單和銷售功能
5. 驗證價格輸入和確認流程
```

---

## 🚀 開發效率提升

使用 Playwright MCP 可以：

1. **加速開發** - 快速理解和測試網頁交互
2. **降低錯誤** - 提前發現和解決潛在問題
3. **提高質量** - 更好的元素定位和錯誤處理
4. **便於維護** - 當網站結構變化時快速適應

記住：**MCP 是開發工具，Python 代碼是最終產品**！ 